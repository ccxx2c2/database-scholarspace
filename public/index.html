<!doctype html>
<html lang='zh-CN'>
<head>
	<meta charset='utf-8'/>
	<title></title>
	<link href="/bootstrap.min.css" rel="stylesheet">
	<style>
		.jumbotron{
			text-align: center;
			background-image: url(./index.svg);
			color:#ffffff;
		}
		.onetext{
			width:500px;
		}
		.twotext{
			width:250px;
		}
		.form-inline .input-group> .form-control{
			width:auto;
		}
	</style>
</head>
<body>
	<nav class="navbar navbar-default">
		  <div class="container-fluid">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="navbar-header">
		      <a class="navbar-brand" href="#">ScholarSpace</a>
		    </div>

   		 <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"> 
   		<ul class="nav navbar-nav navbar-right">
        <li><a href="#">中国人民大学</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div id="app">
	<div class="jumbotron masthead">
		<div class="container">
	<h1>ScholarSpace Demo</h1>
	<p>...</p>
	<p>
		<div class="form-inline" >
		  <div class="form-group">
		  	<div class="btn-group" role="group">
			    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			      {{types[typepoint]}}
			      <span class="caret"></span>
			    </button>
			    <ul class="dropdown-menu">
			      <li v-for='(type,index) in types' v-if='index !== typepoint'><a href="#" v-on:click="typepoint=index">{{type}}</a></li>
			    </ul>
			  </div>
		    <div class="input-group">
		      <input type="text" class="form-control" id="input1" v-bind:placeholder="entities[entitiespoint] + '名称'" style="width:500px" v-if="typepoint===0" v-model="message1">
		      <input type="text" class="form-control" id="input2" :placeholder="typepoint === 1?'学者名称1':'个人用户名'" style="width:250px"  v-if="typepoint !== 0" v-model="message2">
		      <input type="text" class="form-control" id="input3" :placeholder="typepoint === 1?'学者名称2':'待发表关键词（空格分隔）'" style="width:250px"  v-if="typepoint !== 0" v-model="message3">
		    </div>
		   <div class="btn-group" role="group" v-if="typepoint===0">
			    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			      {{entities[entitiespoint]}}
			      <span class="caret"></span>
			    </button>
			    <ul class="dropdown-menu">
			      <li v-for='(entity,index) in entities' v-if='index !== entitiespoint'><a href="#" v-on:click="entitiespoint=index">{{entity}}</a></li>
			    </ul>
			  </div>
		   <div class="btn-group" role="group" v-if="typepoint===2">
			    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			      {{options[recommendpoint]}}
			      <span class="caret"></span>
			    </button>
			    <ul class="dropdown-menu">
			      <li v-for='(entity,index) in options' v-if='index !== recommendpoint'><a href="#" v-on:click="recommendpoint=index">{{entity}}</a></li>
			    </ul>
			  </div>
		  </div>
		  <button type="button" class="btn btn-primary" @click="searchsubmit()" id='searchbutton'>
		  Search
		</button>
		</div>
</p>

</div>
	</div>
<div id="searchres" v-if="tabledata !== {}" class="container">
	<table class="table">
		<tr>
			<th v-for="head in tabledata.head">{{head}}</th>
		</tr>
		<tr v-for="item in tabledata.result">
			<td v-for="(value,key) in item">
				<a href="#" @click="idsubmit(value)" v-if="key=='id'">{{value}}</a>
				<template v-if="key!='id'">{{value}}</template></td>
		</tr>
	</table>
</div>
	</div>
	<script src="/jquery.min.js"></script>
	<script type="text/javascript" src="/bootstrap.js"></script>
    <script src="/socket.io/socket.io.js"></script>
	<script src="vue.js"></script>
	<script src="/vue-resource.js"></script>
<script src="/vue-router.js"></script>
<script>
	var app;
	var socket = io();
	app = new Vue({
		el:'#app',
		data:{
			foo2:'aaa',
			typepoint:0,
			types:['信息查询','学者间关系','寻求推荐'],
			entitiespoint:0,
			entities:['学者','论文','机构'],
			recommendpoint:0,
			options:['学者','论文关键词','机构'],
			message1:'',
			message2:'',
			message3:'',
			tabledata:{},
		},
		methods:{

			searchsubmit:function(){
				$('.jumbotron').attr('style','padding-top:0px;height:200px;');
				var query;
				console.log(this.typepoint);
				/*if(this.typepoint === 0){
					query = '/searchroot?type=' + this.typepoint + '&name=' + this.message1 + '&rectype=' + this.entitiespoint;
				}
				else{
					query = '/searchroot?type=' + this.typepoint + '&name1=' + this.message2 + '&name2=' + this.message3 ;
					if(this.typepoint === 2){
						query +=  '&rectype=' + this.recommendpoint;
					}
				}
				
				console.log(query);/*
				app.$http.get(query)
					.then((response) =>{
						console.log(response);
						foofoo=response;
					});
*/
				socket.emit('searchroot',{
					type:this.typepoint,
					name:this.message1,
					rectype:this.entitiespoint
				});
			},
			idsubmit:function(myid){
				socket.emit('idroot',{
					type:this.tabledata.type,
					id:myid
				});
			}


		}
	});
socket.on('searchroot',(data)=>{
	app.tabledata = data;
});
socket.on('idroot',(data)=>{
	console.log('idroot::');
	console.log(data);
})
$("body").on('keyup',function(event){
        if(event.keyCode === 13){
        	$('#searchbutton').click();
            return;
        }

});

</script>
</body>
</html>
